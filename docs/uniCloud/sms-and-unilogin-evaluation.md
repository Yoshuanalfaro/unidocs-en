近期，uniCloud阿里云版开始正式商用，部分开发者对基于uniCloud的`短信`和`一键登录`业务开始纠结，不清楚`短信`和`一键登录`业务比之前会多花费多少钱，对比其它厂家是否还具有价格优势。

本文尝试算细账、算总账，以阿里云[按量计费](https://uniapp.dcloud.net.cn/uniCloud/price.html#aliyun-postpay)为例，详细预测`短信`和`一键登录`业务在不同用户规模下的资源消耗及对应费用，帮助大家明智选择，无忧开发。

本文主要分为两个部分：
- 短信和一键登录业务的消耗资源费用测算
- 综合考虑，你该如何选择

## 短信和一键登录业务的消耗资源费用测算

`短信`和`一键登录`业务涉及费用的部分主要是云函数/云对象的使用量、调用次数、和出网流量(如：使用`uni-id-co`或自定义的云函数/云对象来发送短信)。
接下来，我们对不同资源，分别进行费用评估。

我们按照[uniCloud官网](https://uniapp.dcloud.net.cn/uniCloud/price.html#aliyun-postpay)列出的按量计费规则，计算一下云函数的资源消耗。

![](https://mp-8ca8132b-2139-4831-aff2-582d4c8385da.cdn.bspapp.com/cloudstorage/8492ba8e-f4c6-45de-abf2-f9d6825ceefb.png)

我们可以简单得出如下公式：

`云函数/云对象费用 = 资源使用量 * 0.000110592  + 调用次数 * 0.0133 / 10000 + 出网流量 * 0.8`

其中：
- 资源使用量 = 云函数内存（单位为G） * 云函数平均单次执行时长（单位为秒） * 调用次数
- 调用次数 = 发送短信条数（一般情况下发送条数 = 调用次数，特殊情况除外）+ 一键登录调用次数（如果只使用其中某一项业务，则可设另一项业务调用次数为0）


我们假设如下数据模型：

- 云函数内存：512M，即0.5G （云函数内存默认为512M，用户可以自定义设置，最低可设置为128M）
- 云函数平均单次执行时长：200毫秒，即0.2秒
- 短信和一键登录业务平均每日调用次数：10000次
- 出网流量：单次请求 2 KB

按照如上公式，其`短信`业务云函数每天的费用为：

```
云函数费用（天） = 资源使用量 * 0.000110592  + 调用次数 * 0.0133 / 10000 + 出网流量 * 0.8
			  = 云函数内存（单位为G） * 云函数平均单次执行时长（单位为秒） * 调用次数 + 调用次数 * 0.0133 / 10000 + 出网流量 * 0.8
			  = 0.5G * 0.2S * 10000 * 0.000110592 + 10000 * 0.0133/10000 + 10000 * 2 * 0.8 / 1024 * 1024 
			  = 0.110592 + 0.0133 + 0.0152587890625
			  = 0.1391507890625（元）
			  ≈ 0.139（元）
```

即：如果你的`短信`和`一键登录`业务平均每天发送条数为10000条，使用阿里云商业版云服务空间后，对应云函数每天大概消耗0.139元，对比之前的短信和一键登录费用，平均每次调用多花0.0000139元。


## 综合考虑，你该如何选择

再次说回`短信`和`一键登录`业务，通过上面的费用测算可得知，`短信`和`一键登录`业务单次调用费用只增加了0.0000139元，几乎可以忽略不计，相比其它厂商仍然保持着价格优势。

以日均调用1000次来说，每月才多了0.417元，每年才多了5块钱，一年多花5块钱，可以省掉工程师重新选择厂商对接的成本，让工程师将更多精力投入核心业务中。这5块钱的买卖，不划算吗？它不香吗？

不重复制造轮子，聚焦业务，快速验证模式，实现商业增长，才应该是聪明工程师的追求。

本篇评测仅供大家参考。


